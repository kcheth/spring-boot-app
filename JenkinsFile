pipeline {
  agent any
   tools {
    maven 'maven'
   }
  stages {
   stage('Checkout') {
      steps {
        git credentialsId: 'key', url: 'https://kcheth@bitbucket.org/cloudzenix/sonar-app.git'
      }
    }
   stage('Build and Test') {
      steps {
        // build the project and create a JAR file
        sh 'cd java-maven-sonar-argocd-k8s/spring-boot-app && mvn clean package'
      }
    }
   stage('sonarcodescan'){
            steps {
            withSonarQubeEnv('sonar') {
              sh 'cd java-maven-sonar-argocd-k8s/spring-boot-app && mvn sonar:sonar'
              }
            }
         }
  }
 }
